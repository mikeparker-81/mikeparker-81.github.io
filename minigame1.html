<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1" />
<title>í„°ì¹˜ ìƒì¡´ ë¦¬ê·¸ ì™„ì „ì²´</title>
<style>
  html, body {
    margin: 0; padding: 0;
    height: 100%;
    overflow: hidden;
    background: linear-gradient(135deg, #0f0f0f, #1c1c1c);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    -webkit-user-select: none;
    -ms-user-select: none;
    user-select: none;
    touch-action: none;
  }

  #overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.85);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 10000;
  }

  #playerButtons {
    display: grid;
    grid-template-columns: repeat(5, 72px);
    grid-template-rows: repeat(2, 50px);
    gap: 12px 20px;
    margin-bottom: 30px;
  }

  #playerButtons button {
    background: #222;
    border: 2px solid #00ffff;
    border-radius: 10px;
    color: #00ffff;
    font-size: 18px;
    font-weight: 700;
    cursor: pointer;
    transition: background 0.3s, color 0.3s;
  }
  #playerButtons button.selected,
  #playerButtons button:hover {
    background: #00ffff;
    color: #111;
  }

  #startBtn {
    background: #00cccc;
    border: none;
    border-radius: 14px;
    color: #111;
    font-size: 22px;
    font-weight: 700;
    padding: 14px 36px;
    cursor: pointer;
    user-select: none;
    opacity: 0.6;
    transition: opacity 0.3s;
  }
  #startBtn.enabled {
    opacity: 1;
  }

  .circle {
    position: absolute;
    width: 100px; height: 100px;
    border-radius: 50%;
    pointer-events: none;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    box-shadow: 0 0 10px rgba(255,255,255,0.5);
    color: white;
    user-select: none;
  }
  .circle.mainNumber {
    font-size: 26px;
    text-shadow:
      -1px -1px 1px #000,
      1px 1px 1px #000;
  }
  .circle.outsideNumber {
    position: absolute;
    font-weight: 700;
    font-size: 14px;
    user-select: none;
    pointer-events: none;
    color: white;
    text-shadow: 0 0 3px #000;
  }

  #messageBox {
    position: fixed;
    inset: 40% 0 0 0;
    width: 100%;
    text-align: center;
    font-size: 36px;
    font-weight: 700;
    color: #00cccc;
    background: #111;
    padding: 30px 0;
    user-select: none;
    z-index: 9999;
    box-shadow: 0 0 20px #00cccc88;
    cursor: default;
  }

  #leagueBoard {
    position: fixed;
    top: 12px;
    left: 12px;
    max-width: 280px;
    z-index: 9999;
    background: rgba(0,0,0,0.6);
    border-radius: 10px;
    padding: 6px 12px;
    font-size: 16px;
    color: white;
    font-weight: 600;
    user-select: none;
    box-shadow: 0 0 10px #00cccc99;
    max-height: 80vh;
    overflow-y: auto;
  }
  #leagueBoard .entry {
    margin-bottom: 6px;
    display: flex;
    align-items: center;
  }
  #leagueBoard .colorBox {
    width: 20px;
    height: 20px;
    margin-right: 10px;
    border-radius: 4px;
    border: 1.5px solid #ddd;
  }

</style>
</head>
<body>

<div id="overlay">
  <div id="playerButtons">
    <button data-count="5">5ëª…</button>
    <button data-count="10">10ëª…</button>
    <button data-count="15">15ëª…</button>
    <button data-count="20">20ëª…</button>
    <button data-count="25">25ëª…</button>
  </div>
  <button id="startBtn" disabled>ì°¸ê°€ ì¸ì› ì„ íƒí•˜ì„¸ìš”</button>
</div>

<div id="leagueBoard"></div>

<div id="messageBox" style="display:none;"></div>

<script>
  const maxGroup = 5;
  const overlay = document.getElementById('overlay');
  const playerButtons = document.querySelectorAll('#playerButtons button');
  const startBtn = document.getElementById('startBtn');
  const messageBox = document.getElementById('messageBox');
  const leagueBoard = document.getElementById('leagueBoard');

  let totalPlayers = 0;
  let remainingPlayers = [];
  let finalists = [];
  let round = 1;
  let gameStarted = false;
  let touches = {};
  let idleTimeout = null;

  // ì„ íƒëœ ì°¸ê°€ ì¸ì› ë²„íŠ¼ ê´€ë¦¬
  let selectedCount = 0;
  playerButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      playerButtons.forEach(b => b.classList.remove('selected'));
      btn.classList.add('selected');
      selectedCount = parseInt(btn.dataset.count);
      startBtn.disabled = false;
      startBtn.textContent = selectedCount >= 10 ? 'ë¦¬ê·¸ ì‹œì‘' : 'ì‹œì‘';
      startBtn.classList.add('enabled');
    });
  });

  startBtn.addEventListener('click', () => {
    if (!selectedCount) return;
    totalPlayers = selectedCount;
    remainingPlayers = Array.from({ length: totalPlayers }, (_, i) => i + 1);
    finalists = [];
    round = 1;
    gameStarted = false;
    touches = {};
    leagueBoard.innerHTML = '';
    overlay.style.display = 'none';
    showRoundMessage(`${round}ë¼ìš´ë“œ: ì†ê°€ë½ì„ ì˜¬ë ¤ì£¼ì„¸ìš” (ìµœëŒ€ ${maxGroup}ëª…)`);
  });

  function getRandomColor() {
    const letters = '0123456789ABCDEF';
    let color = '#';
    for (let i = 0; i < 6; i++) color += letters[Math.floor(Math.random() * 16)];
    return color;
  }

  // ì°¸ê°€ì í„°ì¹˜ ì‹œ ì› ìƒì„± ë° ë²ˆí˜¸ í‘œì‹œ
  function createCircle(id, x, y, number, color) {
    // ë©”ì¸ ì›
    const circle = document.createElement('div');
    circle.classList.add('circle', 'mainNumber');
    circle.style.left = `${x - 50}px`;
    circle.style.top = `${y - 50}px`;
    circle.style.backgroundColor = color;
    circle.dataset.id = id;
    circle.textContent = number;
    document.body.appendChild(circle);

    // ì› ë°– ì‘ì€ ë²ˆí˜¸
    const outsideNum = document.createElement('div');
    outsideNum.classList.add('circle', 'outsideNumber');
    outsideNum.dataset.id = id;
    outsideNum.textContent = number;
    outsideNum.style.color = color;
    document.body.appendChild(outsideNum);

    return {circle, outsideNum};
  }

  function updateCirclePosition(id, x, y) {
    const circle = document.querySelector(`.circle.mainNumber[data-id='${id}']`);
    const outsideNum = document.querySelector(`.circle.outsideNumber[data-id='${id}']`);
    if (circle && outsideNum) {
      circle.style.left = `${x - 50}px`;
      circle.style.top = `${y - 50}px`;
      // ë°– ë²ˆí˜¸ ìœ„ì¹˜ (ì› ë°–, ì•„ë˜ìª½ ì¤‘ì•™ìœ¼ë¡œ ì‚´ì§ ë„ì›€)
      outsideNum.style.left = `${x - 10}px`;
      outsideNum.style.top = `${y + 55}px`;
    }
  }

  function removeCircle(id) {
    const circle = document.querySelector(`.circle.mainNumber[data-id='${id}']`);
    const outsideNum = document.querySelector(`.circle.outsideNumber[data-id='${id}']`);
    if (circle) circle.remove();
    if (outsideNum) outsideNum.remove();
  }

  // ì¢Œìƒë‹¨ ë¦¬ê·¸ ìš°ìŠ¹ì ëˆ„ì  í‘œì‹œ
  function addLeagueEntry(number, color) {
    const entry = document.createElement('div');
    entry.className = 'entry';
    const colorBox = document.createElement('div');
    colorBox.className = 'colorBox';
    colorBox.style.backgroundColor = color;
    const text = document.createElement('div');
    text.textContent = `${number}ë²ˆ`;
    text.style.color = color;
    entry.appendChild(colorBox);
    entry.appendChild(text);
    leagueBoard.appendChild(entry);
  }

  // ë©”ì‹œì§€ ì¤‘ì•™ì— í¬ê²Œ ë³´ì—¬ì£¼ê¸°, í„°ì¹˜ ì‹œ ì½œë°± ì—°ê²°
  function showRoundMessage(text, clickable=false, callback=null) {
    messageBox.textContent = text;
    messageBox.style.display = 'block';
    messageBox.style.cursor = clickable ? 'pointer' : 'default';
    if (clickable) {
      const onClick = () => {
        messageBox.style.display = 'none';
        messageBox.style.cursor = 'default';
        messageBox.removeEventListener('click', onClick);
        if (callback) callback();
      };
      messageBox.addEventListener('click', onClick);
    }
  }

  // ê²Œì„ ì‹œì‘ ì¡°ê±´ ì²´í¬ í›„ 3ì´ˆ í›„ ê²Œì„ ì‹œì‘
  function checkIfIdle() {
    if (Object.keys(touches).length >= 2 && !gameStarted) {
      if (idleTimeout) clearTimeout(idleTimeout);
      idleTimeout = setTimeout(() => {
        startGame();
      }, 3000);
    } else {
      if (idleTimeout) clearTimeout(idleTimeout);
    }
  }

  // ê²Œì„ ë©”ì¸ ë¡œì§: ëœë¤ íƒˆë½ ë°˜ë³µ
  function startGame() {
    gameStarted = true;
    showRoundMessage(`${round}ë¼ìš´ë“œ ì§„í–‰ì¤‘... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”`);

    const ids = Object.keys(touches);
    if (ids.length === 0) {
      // í„°ì¹˜ìê°€ ì—†ìœ¼ë©´ ë‹¤ì‹œ ëŒ€ê¸°
      gameStarted = false;
      showRoundMessage(`${round}ë¼ìš´ë“œ: ì†ê°€ë½ì„ ì˜¬ë ¤ì£¼ì„¸ìš” (ìµœëŒ€ ${maxGroup}ëª…)`);
      return;
    }

    const eliminationInterval = setInterval(() => {
      if (ids.length <= 1) {
        clearInterval(eliminationInterval);
        const winnerId = ids[0];
        const winner = touches[winnerId];
        if (!winner) {
          showRoundMessage('ì°¸ê°€ìê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. ë‹¤ì‹œ ì‹œì‘í•˜ì„¸ìš”.', true, resetGame);
          return;
        }
        addLeagueEntry(winner.number, winner.color);
        finalists.push({ number: winner.number, color: winner.color });

        showRoundMessage(
          `${round === 'ğŸ”¥ ê²°ìŠ¹ì „' ? 'ê²°ìŠ¹ì „' : round + 'ë¼ìš´ë“œ'} ë‹¹ì²¨ì: ` +
          `%c${winner.number}ë²ˆ`,
          true,
          () => {
            nextRoundOrFinish();
          }
        );

        // í…ìŠ¤íŠ¸ ìƒ‰ìƒ ì§ì ‘ ì ìš©
        messageBox.innerHTML = `${round === 'ğŸ”¥ ê²°ìŠ¹ì „' ? 'ê²°ìŠ¹ì „' : round + 'ë¼ìš´ë“œ'} ë‹¹ì²¨ì: <span style="color:${winner.color}; font-weight:700;">${winner.number}ë²ˆ</span><br><small>í„°ì¹˜í•˜ë©´ ë‹¤ìŒ ì§„í–‰</small>`;

        gameStarted = false;

        // í„°ì¹˜ ì›ë“¤ ì œê±°
        Object.keys(touches).forEach(removeCircle);
        touches = {};
      } else {
        // ëœë¤ íƒˆë½ í•œëª… ì œê±°
        const removedIndex = Math.floor(Math.random() * ids.length);
        const removedId = ids.splice(removedIndex, 1)[0];
        removeCircle(removedId);
        delete touches[removedId];
      }
    }, 1500);
  }

  // ë‹¤ìŒ ë¼ìš´ë“œ ì§„í–‰ ë˜ëŠ” ê²°ìŠ¹ ì‹œì‘/ë ì²˜ë¦¬
  function nextRoundOrFinish() {
    // ë‚¨ì€ í”Œë ˆì´ì–´ê°€ ìˆìœ¼ë©´ ë¼ìš´ë“œ++
    if (remainingPlayers.length > 0 && round !== 'ğŸ”¥ ê²°ìŠ¹ì „') {
      round++;
      showRoundMessage(`${round}ë¼ìš´ë“œ: ì†ê°€ë½ì„ ì˜¬ë ¤ì£¼ì„¸ìš” (ìµœëŒ€ ${maxGroup}ëª…)`);
    } else if (finalists.length > 1) {
      // ê²°ìŠ¹ ì‹œì‘
      remainingPlayers = finalists.map(f => f.number);
      finalists = [];
      round = 'ğŸ”¥ ê²°ìŠ¹ì „';
      showRoundMessage(`${round}: ì†ê°€ë½ì„ ì˜¬ë ¤ì£¼ì„¸ìš” (ìµœëŒ€ ${maxGroup}ëª…)`);
    } else {
      // ìµœì¢… ìš°ìŠ¹ì ë°œí‘œ
      const champ = finalists[0];
      showRoundMessage(
        `ğŸ† ìµœì¢… ìš°ìŠ¹ì: <span style="color:${champ.color}; font-weight:700;">${champ.number}ë²ˆ</span><br><small>í„°ì¹˜í•˜ë©´ ì¬ì‹œì‘</small>`,
        true,
        resetGame
      );
    }
  }

  // ê²Œì„ ë¦¬ì…‹ ë° ë‹¤ì‹œ ì¸ì› ì„ íƒ í™”ë©´ ë³´ì—¬ì£¼ê¸°
  function resetGame() {
    overlay.style.display = 'flex';
    startBtn.disabled = true;
    startBtn.textContent = 'ì°¸ê°€ ì¸ì› ì„ íƒí•˜ì„¸ìš”';
    playerButtons.forEach(b => b.classList.remove('selected'));
    leagueBoard.innerHTML = '';
    messageBox.style.display = 'none';
    totalPlayers = 0;
    remainingPlayers = [];
    finalists = [];
    round = 1;
    gameStarted = false;
    touches = {};
  }

  // í„°ì¹˜ ì´ë²¤íŠ¸ ê´€ë¦¬
  window.addEventListener('touchstart', e => {
    if (gameStarted) return;
    if (overlay.style.display === 'flex') return; // ì‹œì‘ ì „ í™”ë©´ í„°ì¹˜ ë¬´ì‹œ
    // ë©”ì‹œì§€ ìˆ¨ê¸°ê¸°
    if (messageBox.style.display === 'block') {
      messageBox.style.display = 'none';
    }
    for (const t of e.changedTouches) {
      if (Object.keys(touches).length >= maxGroup) return;
      if (!touches[t.identifier]) {
        const number = remainingPlayers.shift();
        if (!number) return;
        const color = getRandomColor();
        const {circle, outsideNum} = createCircle(t.identifier, t.clientX, t.clientY, number, color);
        touches[t.identifier] = { el: circle, outsideNum, number, color };
      }
    }
    checkIfIdle();
  });

  window.addEventListener('touchmove', e => {
    if (gameStarted) return;
    for (const t of e.changedTouches) {
      if (touches[t.identifier]) updateCirclePosition(t.identifier, t.clientX, t.clientY);
    }
  });

  window.addEventListener('touchend', e => {
    if (gameStarted) return;
    for (const t of e.changedTouches) {
      if (touches[t.identifier]) {
        removeCircle(t.identifier);
        remainingPlayers.unshift(touches[t.identifier].number);
        delete touches[t.identifier];
      }
    }
    showRoundMessage(`${round}ë¼ìš´ë“œ: ì†ê°€ë½ì„ ì˜¬ë ¤ì£¼ì„¸ìš” (ìµœëŒ€ ${maxGroup}ëª…)`);
  });

  // ì œìŠ¤ì²˜ ë¬´íš¨ ì²˜ë¦¬
  ['gesturestart', 'gesturechange', 'gestureend'].forEach(ev => {
    document.addEventListener(ev, e => e.preventDefault());
  });
  document.addEventListener('touchmove', e => e.preventDefault(), { passive: false });

</script>

</body>
</html>
