<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1" />
  <title>í„°ì¹˜ ìƒì¡´ ë¦¬ê·¸</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      touch-action: none;
      background: linear-gradient(135deg, #0f0f0f, #1c1c1c);
      font-family: 'Segoe UI', sans-serif;
      -webkit-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }

    #config {
      position: absolute;
      top: 40px;
      left: 50%;
      transform: translateX(-50%);
      color: white;
      font-size: 20px;
      text-align: center;
      z-index: 9999;
      background-color: rgba(0, 0, 0, 0.6);
      padding: 12px 20px;
      border-radius: 12px;
      box-shadow: 0 0 15px #00ff0055;
    }

    #config select, #config button {
      margin: 10px;
      padding: 6px 10px;
      font-size: 16px;
      border-radius: 6px;
      border: none;
    }

    /* ë¼ìš´ë“œë³„ ë‹¹ì²¨ì í‘œì‹œ ì˜ì—­ */
    #winners-display {
      position: absolute;
      top: 20px;
      left: 20px;
      color: white;
      font-size: 14px;
      background-color: rgba(0, 0, 0, 0.7);
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(255,255,255,0.3);
      z-index: 9998;
      display: none;
      max-height: 300px;
      overflow-y: auto;
    }

    .winner-item {
      margin: 3px 0;
      font-weight: bold;
    }

    /* ìµœì¢… ê²°ê³¼ í…Œì´ë¸” */
    #results-table {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 0 20px rgba(0, 255, 0, 0.5);
      z-index: 10000;
      display: none;
      max-height: 80vh;
      max-width: 90vw;
      overflow-y: auto;
      min-width: 300px;
    }

    #results-table h2 {
      text-align: center;
      color: #00ff00;
      margin-top: 0;
    }

    .results-section {
      margin: 15px 0;
    }

    .results-section h3 {
      color: #ffcc00;
      border-bottom: 1px solid #333;
      padding-bottom: 5px;
    }

    .player-item {
      padding: 5px 10px;
      margin: 3px 0;
      border-radius: 5px;
      background-color: rgba(255, 255, 255, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .player-number {
      font-weight: bold;
      font-size: 16px;
    }

    .circle {
      position: absolute;
      width: 100px;
      height: 100px;
      border-radius: 50%;
      transform: scale(1);
      animation: pulse 1s infinite;
      pointer-events: none;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 26px;
      font-weight: bold;
      color: white;
      box-shadow: 0 0 10px rgba(255,255,255,0.5);
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.3); }
      100% { transform: scale(1); }
    }

    #message {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      color: #00ff00;
      font-size: 18px;
      text-align: center;
      z-index: 9999;
      max-width: 90%;
      padding: 8px 0;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
    }

    .next-button {
      background-color: #00ff00;
      color: black;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      margin-top: 10px;
      transition: all 0.3s;
    }

    .next-button:hover {
      background-color: #00cc00;
      transform: scale(1.05);
    }

    .restart-button {
      background-color: #ff6600;
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      margin-top: 15px;
      transition: all 0.3s;
    }

    .restart-button:hover {
      background-color: #e55a00;
      transform: scale(1.05);
    }

    /* ê²½ê³  ë©”ì‹œì§€ */
    #warning-message {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: rgba(255, 0, 0, 0.9);
      color: white;
      padding: 20px;
      border-radius: 10px;
      font-size: 18px;
      font-weight: bold;
      text-align: center;
      z-index: 10001;
      display: none;
      box-shadow: 0 0 20px rgba(255, 0, 0, 0.7);
    }
  </style>
</head>
<body>
  <div id="config">
    <label for="playerCount">ì°¸ê°€ ì¸ì› (2-25ëª…):</label>
    <input type="number" id="playerCount" min="2" max="25" value="10" style="width: 60px; text-align: center;">
    <button onclick="startLeague()">ë¦¬ê·¸ ì‹œì‘</button>
  </div>

  <div id="winners-display"></div>

  <div id="results-table" style="max-height: 80vh; overflow-y: auto;">
    <h2>ğŸ† ìµœì¢… ê²°ê³¼</h2>
    <div class="results-section">
      <h3>ğŸ¥‡ ìš°ìŠ¹ì</h3>
      <div id="winner-list"></div>
    </div>
    <div class="results-section">
      <h3>ğŸ… ìƒì¡´ì (ë¼ìš´ë“œë³„)</h3>
      <div id="survivors-list"></div>
    </div>
    <div class="results-section">
      <h3>âŒ íƒˆë½ì</h3>
      <div id="eliminated-list"></div>
    </div>
    <div style="text-align: center; padding: 20px; position: sticky; bottom: 0; background: inherit;">
      <button class="restart-button" onclick="resetGame()">ë‹¤ì‹œ ì‹œì‘</button>
    </div>
  </div>

  <div id="warning-message"></div>

  <div id="message">ì°¸ê°€ ì¸ì›ì„ ì„ íƒí•˜ê³  ì‹œì‘í•˜ì„¸ìš”</div>

  <script>
    const touches = {};
    let gameStarted = false;
    let waitingForNext = false;
    let checkIdleTimeout = null;
    let totalPlayers = 0;
    let remainingPlayers = [];
    let allSurvivors = []; // ë¼ìš´ë“œë³„ ìƒì¡´ì ê¸°ë¡
    let eliminatedPlayers = []; // íƒˆë½ì ê¸°ë¡
    let round = 1;
    let isFinal = false;

    // ê²½ê³  ë©”ì‹œì§€ í‘œì‹œ
    function showWarning(message) {
      const warningEl = document.getElementById('warning-message');
      warningEl.textContent = message;
      warningEl.style.display = 'block';
      setTimeout(() => {
        warningEl.style.display = 'none';
      }, 3000);
    }

    // ìƒ‰ìƒ ì½”ë“œë¥¼ í•œê¸€ ìƒ‰ìƒëª…ìœ¼ë¡œ ë³€í™˜
    function getColorName(hexColor) {
      const colorMap = {
        'F': 'ë¹¨ê°•', 'E': 'ë¹¨ê°•', 'D': 'ë¹¨ê°•', 'C': 'ë¹¨ê°•',
        'B': 'ì£¼í™©', 'A': 'ì£¼í™©', '9': 'ë…¸ë‘', '8': 'ë…¸ë‘',
        '7': 'ì´ˆë¡', '6': 'ì´ˆë¡', '5': 'íŒŒë‘', '4': 'íŒŒë‘',
        '3': 'ë³´ë¼', '2': 'ë³´ë¼', '1': 'ë¶„í™', '0': 'ë¶„í™'
      };
      const firstChar = hexColor.charAt(1).toUpperCase();
      return colorMap[firstChar] || 'ë¬´ì§€ê°œ';
    }

    function getRandomColor() {
      const colors = [
        '#FF4444', '#44FF44', '#4444FF', '#FFFF44', '#FF44FF', 
        '#44FFFF', '#FF8844', '#88FF44', '#4488FF', '#FF4488',
        '#88FF88', '#8888FF', '#FFAA44', '#AA44FF', '#44AAFF'
      ];
      return colors[Math.floor(Math.random() * colors.length)];
    }

    function createCircle(id, x, y, number, color) {
      const circle = document.createElement('div');
      circle.classList.add('circle');
      circle.style.left = `${x - 50}px`;
      circle.style.top = `${y - 50}px`;
      circle.style.backgroundColor = color;
      circle.dataset.id = id;
      circle.textContent = number;
      document.body.appendChild(circle);
      return circle;
    }

    function removeCircle(id) {
      const el = document.querySelector(`.circle[data-id='${id}']`);
      if (el) el.remove();
    }

    function updateCirclePosition(id, x, y) {
      const el = document.querySelector(`.circle[data-id='${id}']`);
      if (el) {
        el.style.left = `${x - 50}px`;
        el.style.top = `${y - 50}px`;
      }
    }

    function updateMessage(msg, showButton = false, buttonText = 'ë‹¤ìŒ ë¼ìš´ë“œ') {
      const el = document.getElementById('message');
      el.innerHTML = msg;
      if (showButton) {
        el.innerHTML += `<br><button class="next-button" onclick="proceedToNext()">${buttonText}</button>`;
      }
      el.style.display = 'block';
    }

    function updateWinnersDisplay() {
      const display = document.getElementById('winners-display');
      if (allSurvivors.length === 0) {
        display.style.display = 'none';
        return;
      }
      
      display.style.display = 'block';
      display.innerHTML = '<div style="font-weight: bold; margin-bottom: 8px; color: #00ff00;">ìƒì¡´ì ê¸°ë¡</div>';
      
      allSurvivors.forEach((survivor, index) => {
        const roundLabel = survivor.round === 'ë¶€ì „ìŠ¹' ? 'ë¶€ì „ìŠ¹' : (survivor.isFinal ? 'ê²°ìŠ¹ì „' : `${survivor.round}ë¼ìš´ë“œ`);
        const colorName = getColorName(survivor.color);
        const item = document.createElement('div');
        item.className = 'winner-item';
        item.innerHTML = `${roundLabel}: <span style="color: ${survivor.color}">${survivor.number}ë²ˆ (${colorName})</span>`;
        display.appendChild(item);
      });
    }

    function startLeague() {
      const input = document.getElementById('playerCount');
      const inputValue = parseInt(input.value);
      
      if (isNaN(inputValue) || inputValue < 2 || inputValue > 25) {
        showWarning('ì°¸ê°€ ì¸ì›ì€ 2ëª… ì´ìƒ 25ëª… ì´í•˜ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”!');
        input.value = Math.max(2, Math.min(25, inputValue || 10));
        return;
      }
      
      totalPlayers = inputValue;
      remainingPlayers = Array.from({ length: totalPlayers }, (_, i) => i + 1);
      allSurvivors = [];
      eliminatedPlayers = [];
      round = 1;
      
      // ì²˜ìŒë¶€í„° 5ëª… ì´í•˜ë©´ ë°”ë¡œ ê²°ìŠ¹ì „
      isFinal = (remainingPlayers.length <= 5);
      waitingForNext = false;
      
      document.getElementById('config').style.display = 'none';
      document.getElementById('results-table').style.display = 'none';
      
      if (isFinal) {
        updateMessage(`ê²°ìŠ¹ì „: ì†ê°€ë½ì„ ì˜¬ë ¤ì£¼ì„¸ìš” (ìµœì†Œ 2ëª…, ìµœëŒ€ 5ëª…)`, false);
      } else {
        updateMessage(`${round}ë¼ìš´ë“œ: ì†ê°€ë½ì„ ì˜¬ë ¤ì£¼ì„¸ìš” (ìµœì†Œ 2ëª…, ìµœëŒ€ 5ëª…)`, false);
      }
      updateWinnersDisplay();
    }

    function startGame() {
      gameStarted = true;
      const currentRoundLabel = isFinal ? 'ê²°ìŠ¹ì „' : `${round}ë¼ìš´ë“œ`;
      updateMessage(`ê²Œì„ ì‹œì‘! ${currentRoundLabel} ëœë¤ íƒˆë½ ì¤‘...`, false);
      navigator.vibrate && navigator.vibrate([300, 100, 300]);

      const ids = Object.keys(touches);
      const participantNumbers = ids.map(id => touches[id].number);

      const interval = setInterval(() => {
        if (ids.length <= 1) {
          clearInterval(interval);
          const winnerId = ids[0];
          const winner = touches[winnerId];
          const colorName = getColorName(winner.color);
          
          // ìƒì¡´ì ê¸°ë¡
          allSurvivors.push({
            round: round,
            number: winner.number,
            color: winner.color,
            isFinal: isFinal
          });

          // íƒˆë½ì ê¸°ë¡ (ì°¸ê°€í–ˆì§€ë§Œ ìƒì¡´í•˜ì§€ ëª»í•œ ì‚¬ëŒë“¤)
          participantNumbers.forEach(num => {
            if (num !== winner.number) {
              eliminatedPlayers.push({
                round: round,
                number: num,
                color: Object.values(touches).find(t => t.number === num)?.color || '#FFFFFF',
                isFinal: isFinal
              });
            }
          });

          // ë‚¨ì€ í”Œë ˆì´ì–´ ëª©ë¡ì—ì„œ íƒˆë½ì ì œê±° (ìƒì¡´ìëŠ” ìœ ì§€)
          remainingPlayers = remainingPlayers.filter(num => 
            num === winner.number || !participantNumbers.includes(num)
          );

          gameStarted = false;
          waitingForNext = true;

          // ë‹¹ì²¨ìë¥¼ ìƒ‰ìƒê³¼ í•¨ê»˜ í‘œì‹œ
          const nextButtonText = isFinal ? 'ê²°ê³¼ ë³´ê¸°' : 'ë‹¤ìŒ ë¼ìš´ë“œ';
          updateMessage(
            `<span style="color: ${winner.color}; font-weight: bold;">${winner.number}ë²ˆ (${colorName})</span> ìƒì¡´!`, 
            true, 
            nextButtonText
          );

          Object.keys(touches).forEach(removeCircle);
          for (let id in touches) delete touches[id];
          
          updateWinnersDisplay();
          return;
        }

        const randomIndex = Math.floor(Math.random() * ids.length);
        const removedId = ids.splice(randomIndex, 1)[0];
        removeCircle(removedId);
      }, 1500);
    }

    function proceedToNext() {
      if (!waitingForNext) return;
      waitingForNext = false;

      if (isFinal) {
        // ê²°ìŠ¹ì „ì´ ëë‚¬ìœ¼ë¯€ë¡œ ê²°ê³¼ í‘œì‹œ
        showFinalResults();
      } else {
        // ë‚¨ì€ ì¸ì› í™•ì¸
        if (remainingPlayers.length === 1) {
          // 1ëª…ë§Œ ë‚¨ìœ¼ë©´ ë¶€ì „ìŠ¹ìœ¼ë¡œ ê²°ìŠ¹ì „ ì§„ì¶œ
          const lastPlayer = remainingPlayers[0];
          allSurvivors.push({
            round: 'ë¶€ì „ìŠ¹',
            number: lastPlayer,
            color: '#FFD700', // ê¸ˆìƒ‰ìœ¼ë¡œ ë¶€ì „ìŠ¹ í‘œì‹œ
            isFinal: false,
            walkover: true // ë¶€ì „ìŠ¹ í‘œì‹œ
          });
          
          // ë¶€ì „ìŠ¹ìë¥¼ í¬í•¨í•œ ëª¨ë“  ìƒì¡´ìë¡œ ê²°ìŠ¹ì „ ì§„í–‰
          remainingPlayers = allSurvivors.map(s => s.number);
          round++;
          isFinal = true;
          updateMessage(`ê²°ìŠ¹ì „: ëª¨ë“  ìƒì¡´ìê°€ ì°¸ì—¬í•©ë‹ˆë‹¤ (ìµœì†Œ 2ëª…, ìµœëŒ€ 5ëª…)`, false);
          updateWinnersDisplay();
          return;
        }
        
        // ë‹¤ìŒ ë¼ìš´ë“œ ì¤€ë¹„ 
        round++;
        isFinal = (remainingPlayers.length <= 5);
        
        if (isFinal) {
          updateMessage(`ê²°ìŠ¹ì „: ì†ê°€ë½ì„ ì˜¬ë ¤ì£¼ì„¸ìš” (ìµœì†Œ 2ëª…, ìµœëŒ€ 5ëª…)`, false);
        } else {
          updateMessage(`${round}ë¼ìš´ë“œ: ì†ê°€ë½ì„ ì˜¬ë ¤ì£¼ì„¸ìš” (ìµœì†Œ 2ëª…, ìµœëŒ€ 5ëª…)`, false);
        }
      }
    }

    function showFinalResults() {
      document.getElementById('message').style.display = 'none';
      
      // ìš°ìŠ¹ì (ë§ˆì§€ë§‰ ìƒì¡´ì)
      const winner = allSurvivors[allSurvivors.length - 1];
      const winnerColorName = getColorName(winner.color);
      const walkoverText = winner.walkover ? ' (ë¶€ì „ìŠ¹)' : '';
      document.getElementById('winner-list').innerHTML = 
        `<div class="player-item">
          <span class="player-number" style="color: ${winner.color}">${winner.number}ë²ˆ (${winnerColorName})${walkoverText}</span>
          <span>ğŸ†</span>
        </div>`;

      // ìƒì¡´ì ëª©ë¡
      const survivorsList = document.getElementById('survivors-list');
      survivorsList.innerHTML = '';
      allSurvivors.forEach(survivor => {
        const roundLabel = survivor.round === 'ë¶€ì „ìŠ¹' ? 'ë¶€ì „ìŠ¹' : (survivor.isFinal ? 'ê²°ìŠ¹ì „' : `${survivor.round}ë¼ìš´ë“œ`);
        const colorName = getColorName(survivor.color);
        const walkoverText = survivor.walkover ? ' (ë¶€ì „ìŠ¹)' : '';
        const item = document.createElement('div');
        item.className = 'player-item';
        item.innerHTML = `
          <span class="player-number" style="color: ${survivor.color}">${survivor.number}ë²ˆ (${colorName})</span>
          <span style="font-size: 12px;">${roundLabel} ìƒì¡´${walkoverText}</span>
        `;
        survivorsList.appendChild(item);
      });

      // íƒˆë½ì ëª©ë¡
      const eliminatedList = document.getElementById('eliminated-list');
      eliminatedList.innerHTML = '';
      eliminatedPlayers.forEach(eliminated => {
        const roundLabel = eliminated.isFinal ? 'ê²°ìŠ¹ì „' : `${eliminated.round}ë¼ìš´ë“œ`;
        const colorName = getColorName(eliminated.color);
        const item = document.createElement('div');
        item.className = 'player-item';
        item.innerHTML = `
          <span class="player-number" style="color: ${eliminated.color}">${eliminated.number}ë²ˆ (${colorName})</span>
          <span style="font-size: 12px; color: #ff6666;">${roundLabel} íƒˆë½</span>
        `;
        eliminatedList.appendChild(item);
      });

      document.getElementById('results-table').style.display = 'block';
    }

    function resetGame() {
      document.getElementById('config').style.display = 'block';
      document.getElementById('results-table').style.display = 'none';
      document.getElementById('winners-display').style.display = 'none';
      updateMessage('ì°¸ê°€ ì¸ì›ì„ ì„ íƒí•˜ê³  ì‹œì‘í•˜ì„¸ìš”', false);
      
      for (let id in touches) removeCircle(id);
      for (let id in touches) delete touches[id];
      
      gameStarted = false;
      waitingForNext = false;
      totalPlayers = 0;
      remainingPlayers = [];
      allSurvivors = [];
      eliminatedPlayers = [];
      round = 1;
      isFinal = false;
    }

    function checkIfIdle() {
      const currentParticipants = Object.keys(touches).length;
      
      // ìµœì†Œ 2ëª… ì´ìƒ ì°¸ì—¬í•˜ë©´ 3ì´ˆ í›„ ì‹œì‘
      if (currentParticipants >= 2) {
        if (checkIdleTimeout) clearTimeout(checkIdleTimeout);
        checkIdleTimeout = setTimeout(() => {
          if (!gameStarted && !waitingForNext) {
            startGame();
          }
        }, 3000);
      }
    }

    window.addEventListener('touchstart', (e) => {
      if (gameStarted || waitingForNext) return;
      
      const currentParticipants = Object.keys(touches).length;
      
      // ìµœëŒ€ 5ëª…ê¹Œì§€ë§Œ ì°¸ì—¬ ê°€ëŠ¥
      if (currentParticipants >= 5) {
        showWarning('ìµœëŒ€ 5ëª…ê¹Œì§€ë§Œ ì°¸ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!');
        return;
      }
      
      updateMessage('', false);
      
      for (const t of e.changedTouches) {
        if (currentParticipants >= 5) return;
        
        if (!touches[t.identifier]) {
          const number = remainingPlayers.shift();
          if (!number) return;
          const color = getRandomColor();
          const circle = createCircle(t.identifier, t.clientX, t.clientY, number, color);
          touches[t.identifier] = { el: circle, number, color };
        }
      }
      
      checkIfIdle();
    });

    window.addEventListener('touchmove', (e) => {
      if (gameStarted || waitingForNext) return;
      for (const t of e.changedTouches) {
        if (touches[t.identifier]) updateCirclePosition(t.identifier, t.clientX, t.clientY);
      }
    });

    window.addEventListener('touchend', (e) => {
      if (gameStarted || waitingForNext) return;
      for (const t of e.changedTouches) {
        if (touches[t.identifier]) {
          removeCircle(t.identifier);
          remainingPlayers.unshift(touches[t.identifier].number);
          delete touches[t.identifier];
        }
      }
      
      if (isFinal) {
        updateMessage(`ê²°ìŠ¹ì „: ì†ê°€ë½ì„ ì˜¬ë ¤ì£¼ì„¸ìš” (ìµœì†Œ 2ëª…, ìµœëŒ€ 5ëª…)`, false);
      } else {
        updateMessage(`${round}ë¼ìš´ë“œ: ì†ê°€ë½ì„ ì˜¬ë ¤ì£¼ì„¸ìš” (ìµœì†Œ 2ëª…, ìµœëŒ€ 5ëª…)`, false);
      }
    });

    document.addEventListener('gesturestart', e => e.preventDefault());
    document.addEventListener('gesturechange', e => e.preventDefault());
    document.addEventListener('gestureend', e => e.preventDefault());
    document.addEventListener('touchmove', e => e.preventDefault(), { passive: false });
  </script>
</body>
</html>