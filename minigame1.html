<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1">
  <title>í„°ì¹˜ ìƒì¡´ ë¦¬ê·¸ ê²Œì„</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      touch-action: none;
      background-color: #111;
      user-select: none;
    }
    #config {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      color: white;
      font-size: 18px;
      font-family: sans-serif;
      z-index: 9999;
    }
    .circle {
      position: absolute;
      width: 100px;
      height: 100px;
      background: rgba(0, 200, 255, 0.7);
      border-radius: 50%;
      transform: scale(1);
      animation: pulse 1s infinite;
      pointer-events: none;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      font-weight: bold;
      color: white;
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.3); }
      100% { transform: scale(1); }
    }
    #message {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      color: white;
      font-size: 24px;
      font-family: sans-serif;
      z-index: 9999;
    }
  </style>
</head>
<body>
  <div id="config">
    <label for="playerCount">ì°¸ê°€ ì¸ì›:</label>
    <select id="playerCount">
      <option value="5">5ëª…</option>
      <option value="10">10ëª…</option>
      <option value="15">15ëª…</option>
      <option value="20">20ëª…</option>
      <option value="25">25ëª…</option>
    </select>
    <button onclick="startLeague()">ë¦¬ê·¸ ì‹œì‘</button>
  </div>
  <div id="message">ì°¸ê°€ ì¸ì›ì„ ì„ íƒí•˜ê³  ì‹œì‘í•˜ì„¸ìš”</div>

  <script>
    const touches = {};
    let gameStarted = false;
    let checkIdleTimeout = null;
    let totalPlayers = 0;
    let remainingPlayers = [];
    let finalists = [];
    let round = 1;

    function createCircle(id, x, y, number) {
      const circle = document.createElement('div');
      circle.classList.add('circle');
      circle.style.left = `${x - 50}px`;
      circle.style.top = `${y - 50}px`;
      circle.dataset.id = id;
      circle.textContent = number;
      document.body.appendChild(circle);
      return circle;
    }

    function removeCircle(id) {
      const el = document.querySelector(`.circle[data-id='${id}']`);
      if (el) el.remove();
    }

    function updateCirclePosition(id, x, y) {
      const el = document.querySelector(`.circle[data-id='${id}']`);
      if (el) {
        el.style.left = `${x - 50}px`;
        el.style.top = `${y - 50}px`;
      }
    }

    function updateMessage(msg) {
      document.getElementById('message').textContent = msg;
    }

    function resetGame() {
      Object.keys(touches).forEach(id => removeCircle(id));
      for (let id in touches) delete touches[id];
      gameStarted = false;
    }

    function startLeague() {
      resetGame();
      totalPlayers = parseInt(document.getElementById('playerCount').value);
      remainingPlayers = Array.from({ length: totalPlayers }, (_, i) => i + 1);
      finalists = [];
      round = 1;
      updateMessage("ë¦¬ê·¸ê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤! 1ë¼ìš´ë“œ ì¤€ë¹„ ì¤‘...");
      setTimeout(() => {
        updateMessage(`1ë¼ìš´ë“œ: ì†ê°€ë½ì„ ì˜¬ë ¤ì£¼ì„¸ìš” (ìµœëŒ€ 5ëª…)`);
      }, 2000);
    }

    function startGame() {
      gameStarted = true;
      updateMessage(`ê²Œì„ ì‹œì‘! ${round}ë¼ìš´ë“œ íƒˆë½ì ì¶”ì²¨ ì¤‘...`);
      navigator.vibrate && navigator.vibrate([300, 100, 300]);
      const ids = Object.keys(touches);

      const interval = setInterval(() => {
        if (ids.length <= 1) {
          clearInterval(interval);
          const winnerId = ids[0];
          const number = touches[winnerId].number;
          updateMessage(`ğŸ¯ ${number}ë²ˆ ìƒì¡´!`);
          finalists.push(number);
          resetGame();

          if (remainingPlayers.length > 0) {
            round++;
            setTimeout(() => {
              updateMessage(`${round}ë¼ìš´ë“œ: ì†ê°€ë½ì„ ì˜¬ë ¤ì£¼ì„¸ìš” (ìµœëŒ€ 5ëª…)`);
            }, 2000);
          } else if (finalists.length === 1) {
            updateMessage(`ğŸ† ìµœì¢… ìš°ìŠ¹ì: ${finalists[0]}ë²ˆ!`);
            setTimeout(() => {
              updateMessage("ê²Œì„ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œì‘í•˜ë ¤ë©´ ë¦¬ê·¸ ì‹œì‘ì„ ëˆ„ë¥´ì„¸ìš”.");
              startLeague();
            }, 3000);
          } else {
            // ê²°ìŠ¹ì „ìœ¼ë¡œ ì´ë™
            remainingPlayers = [...finalists];
            finalists = [];
            round = 'ê²°ìŠ¹';
            setTimeout(() => {
              updateMessage(`ğŸ”¥ ê²°ìŠ¹ì „: ì†ê°€ë½ì„ ì˜¬ë ¤ì£¼ì„¸ìš” (ìµœëŒ€ 5ëª…)`);
            }, 2000);
          }
          return;
        }
        const randomIndex = Math.floor(Math.random() * ids.length);
        const removedId = ids.splice(randomIndex, 1)[0];
        removeCircle(removedId);
      }, 1500);
    }

    function checkIfIdle() {
      if (Object.keys(touches).length >= 1) {
        if (checkIdleTimeout) clearTimeout(checkIdleTimeout);
        checkIdleTimeout = setTimeout(() => {
          if (!gameStarted) startGame();
        }, 3000);
      }
    }

    window.addEventListener('touchstart', (e) => {
      if (gameStarted) return;
      for (const t of e.changedTouches) {
        if (Object.keys(touches).length >= 5) return;
        if (!touches[t.identifier]) {
          const number = remainingPlayers.shift();
          if (!number) return;
          const circle = createCircle(t.identifier, t.clientX, t.clientY, number);
          touches[t.identifier] = { el: circle, number };
        }
      }
      checkIfIdle();
    });

    window.addEventListener('touchmove', (e) => {
      if (gameStarted) return;
      for (const t of e.changedTouches) {
        if (touches[t.identifier]) {
          updateCirclePosition(t.identifier, t.clientX, t.clientY);
        }
      }
    });

    window.addEventListener('touchend', (e) => {
      for (const t of e.changedTouches) {
        removeCircle(t.identifier);
        if (touches[t.identifier]) {
          remainingPlayers.unshift(touches[t.identifier].number);
          delete touches[t.identifier];
        }
      }
      if (!gameStarted) updateMessage(`${round}ë¼ìš´ë“œ: ì†ê°€ë½ì„ ì˜¬ë ¤ì£¼ì„¸ìš” (ìµœëŒ€ 5ëª…)`);
    });

    // ë¡±í„°ì¹˜ ë°©ì§€ ì´ë²¤íŠ¸
    window.addEventListener('contextmenu', e => e.preventDefault());
    window.addEventListener('selectstart', e => e.preventDefault());
  </script>
</body>
</html>
